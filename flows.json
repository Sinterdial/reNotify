[
    {
        "id": "384abcadb0af9821",
        "type": "tab",
        "label": "转发封闭的Webhook请求到ntfy",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "958c190e9afc8971",
        "type": "http in",
        "z": "384abcadb0af9821",
        "name": "接受其他应用包装的通知",
        "url": "/renotify",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 110,
        "y": 920,
        "wires": [
            [
                "1c6d068f286bd40d"
            ]
        ]
    },
    {
        "id": "eabc066bdd78c542",
        "type": "debug",
        "z": "384abcadb0af9821",
        "name": "观察传入数据特征",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 760,
        "wires": []
    },
    {
        "id": "7526ce23d51cdf2a",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "无匹配的ntfy订阅主题",
        "statusCode": "400",
        "headers": {
            "content-type": "application/json"
        },
        "x": 1500,
        "y": 1520,
        "wires": []
    },
    {
        "id": "fc4020522ee9b4f9",
        "type": "switch",
        "z": "384abcadb0af9821",
        "name": "判断MP事件类型",
        "property": "payload.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "subscribe.added",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "download.added",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "subscribe.complete",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "transfer.complete",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 1490,
        "y": 920,
        "wires": [
            [
                "1e1445ebae1fe53a"
            ],
            [
                "3e8b67037dc3a327",
                "3c7af06b72fec21e"
            ],
            [
                "62098ff47103bd51"
            ],
            [
                "55c8ef842e4a4cd2"
            ],
            [
                "376d93f341066c0b"
            ]
        ],
        "outputLabels": [
            "订阅已添加",
            "下载已添加",
            "订阅已完成",
            "资源已入库",
            "无匹配的MP事件类型"
        ]
    },
    {
        "id": "fe3e3f47e53c7405",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "将打包好的JSON对象发送给nfty",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "3"
            }
        ],
        "x": 2330,
        "y": 560,
        "wires": [
            [
                "f3222f36d1c0363e"
            ]
        ],
        "info": "将通知重新打包转发到ntfy的MoviePilot频道\r\n这里注意如果要用JSON的话转发URL里不能带订阅主题"
    },
    {
        "id": "1e1445ebae1fe53a",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "重新包装订阅已添加通知",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "MoviePilot",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.data.mediainfo.title_year & (payload.data.context.meta_info.season_episode != '' ? ' ' & payload.data.context.meta_info.season_episode : '' ) & ' 已添加订阅'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'【来自用户】' & payload.data.username & '\\n' & \t'【评分】' & payload.data.mediainfo.vote_average & '\\n' &\t'【流行度】' & $round(payload.data.mediainfo.popularity, 2) & '\\n' &\t'【类别】' & payload.data.mediainfo.category\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "payload.data.mediainfo.homepage = '' ? \t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": (payload.data.mediainfo.type = \"电影\" ? \"https://mp.181691.xyz:4584/#/subscribe/movie\" : \"https://mp.181691.xyz:4584/#/subscribe/tv\")\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.mediainfo.detail_link\t    }\t]\t:\t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": (payload.data.mediainfo.type = \"电影\" ? \"https://mp.181691.xyz:4584/#/subscribe/movie\" : \"https://mp.181691.xyz:4584/#/subscribe/tv\")\t    },\t\t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.mediainfo.detail_link\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"官网\",\t        \"url\": payload.data.mediainfo.homepage\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "payload.data.mediainfo.logo_path != null ? payload.data.mediainfo.logo_path : \"https://chevereto.181691.xyz:4584/images/2024/12/26/1000087726.png\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.attach",
                "pt": "msg",
                "to": "payload.data.mediainfo.backdrop_path",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.data",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.type",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.time",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1930,
        "y": 560,
        "wires": [
            [
                "fe3e3f47e53c7405"
            ]
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "9780f7e6ef8e6642",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2760,
        "y": 560,
        "wires": []
    },
    {
        "id": "58673e9845f4a0ef",
        "type": "function",
        "z": "384abcadb0af9821",
        "name": "根据传入内容分发通知",
        "func": "// // 输出1：判断是否为PushRSS通知\n// if ( \"task_title\" in msg.payload ){\n//     return [msg, null, null, null, null];\n// }\n// 判断是否为Miniflux Webhook通知\nif ( \"feed\" in msg.payload ){\n    return [msg, null, null, null, null];\n}\n// 输出2：判断是否为MoviePilot通知\nelse if( \"data\" in msg.payload){\n    if (\"mediainfo\" in msg.payload.data || \"context\" in msg.payload.data){\n        return [null, msg, null, null, null];\n    }\n    else{        \n    }\n}\n// 输出3：判断是否为Docker Image Update Notifier通知\nelse if( \"diun_version\" in msg.payload ){\n    return [null, null, msg, null, null];\n}\n// 输出4：判断是否为Wallos通知\nelse if( \"days_until\" in msg.payload ){\n    return [null, null, null, msg, null];\n}\n// 输出n：无匹配来源，响应相应信息\nelse{\n    msg.payload = context.get(\"error\").payload;\n    return [null, null, null, null, msg];\n}",
        "outputs": 5,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// 部署节点后，此处添加的代码将运行一次。 \n// 定义格式化时间戳函数，取自ChatGPT\nglobal.set(\"formatTimestamp\", function (timestamp) {\n    const date = new Date(timestamp);\n\n    // 获取各部分时间\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份从 0 开始，需要加 1\n    const day = String(date.getDate()).padStart(2, '0');\n    const hour = String(date.getHours()).padStart(2, '0'); // 24 小时制\n    const minute = String(date.getMinutes()).padStart(2, '0');\n    const second = String(date.getSeconds()).padStart(2, '0');\n\n    // 格式化为 \"某年某月某日某时某分某秒\" 的形式\n    return `${year} 年 ${month} 月 ${day} 日 ${hour} 时 ${minute} 分 ${second} 秒`;\n});\n// console.log(formatTimestampWithPadding(timestamp));\n// 输出：2025年01月19日06时53分54秒\n\n\n// 部署节点后，此处添加的代码将运行一次。 \nvar newMsg = {\n    payload: {\n        title: \"无匹配通知类型\",\n        type: \"通知转发失败\",\n        sender: \"未知\",\n        destination: \"Self-Hosted Ntfy\"\n    }\n};\n\ncontext.set(\"error\", newMsg);",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 920,
        "wires": [
            [
                "ce083f6e8e7f05f9"
            ],
            [
                "fc4020522ee9b4f9"
            ],
            [
                "caefea99b7251a3b",
                "d88076e4d7713c05"
            ],
            [
                "de24cbccc28be417"
            ],
            [
                "7526ce23d51cdf2a"
            ]
        ],
        "inputLabels": [
            "传入数据"
        ],
        "outputLabels": [
            "RSSPush",
            "MoviePilot",
            "DockerImageUpdateNotify",
            "Wallos",
            "NoMatched"
        ],
        "icon": "font-awesome/fa-arrows-alt"
    },
    {
        "id": "66eb0c795259065a",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "无匹配的MP事件类型",
        "statusCode": "400",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2300,
        "y": 1060,
        "wires": []
    },
    {
        "id": "f3222f36d1c0363e",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"订阅添加通知发送成功\",\"type\":\"成功处理\",\"sender\":\"MP Webhook\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 560,
        "wires": [
            [
                "9780f7e6ef8e6642"
            ]
        ]
    },
    {
        "id": "caefea99b7251a3b",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "重新包装消息",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "Diun",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "'8100群晖上的Docker: ' & $reverse($split(payload.image, \"/\"))[1] & '/' & $substringBefore($reverse($split(payload.image, \"/\"))[0], ':') & '有新版本发布'\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'### ' & '**' & '发布平台：' & payload.provider & '**' & '\\n' &\t'### ' & '映像全称：' & payload.image & '\\n' &\t'#### ' & '**' & '更新时间：' & $fromMillis($toMillis(payload.created), '[Y0001]/[M01]/[D01] [h#1]:[m01]') & '**' & '\\n' &\t'支持架构：' & '`' & payload.platform & '`' & '\\n' &\t'唯一标识：' & '`' & payload.digest & '`' & '\\n' &\t'抓取列表：' & '`' & payload.mime_type & '`' & '\\n' &\t'Diun版本：' & '`' & payload.diun_version & '`'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "$contains(payload.image, \"docker.io\") ? \t[\t    {\t        \"action\": \"view\",\t        \"label\": \"Docker Hub\",\t        \"url\": payload.hub_link\t    }\t]\t:\t[\t    {\t    }\t    \t    {\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "$contains(payload.image, \"docker.io\") ? \t'http://192.168.5.8:8855/images/2024/12/21/Moby-logo.png'\t:\t''",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.diun_version",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.hostname",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.status",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.provider",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.image",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.hub_llink",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.mime_type",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.digest",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.created",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.platform",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.metadata",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1480,
        "y": 1160,
        "wires": [
            [
                "e30c774c20dc50e4"
            ]
        ],
        "inputLabels": [
            "来自diun的消息"
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "e30c774c20dc50e4",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "将打包好的JSON对象发送给nfty",
        "method": "POST",
        "ret": "bin",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "3"
            },
            {
                "keyType": "other",
                "keyValue": "Markdown",
                "valueType": "other",
                "valueValue": "yes"
            }
        ],
        "x": 1950,
        "y": 1160,
        "wires": [
            [
                "5269fa3aceca98b0"
            ]
        ],
        "info": "将通知重新打包转发到ntfy的MoviePilot频道\r\n这里注意如果要用JSON的话转发URL里不能带订阅主题"
    },
    {
        "id": "5269fa3aceca98b0",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"Docker映像有更新发布\",\"type\":\"成功处理\",\"sender\":\"Diun\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 1160,
        "wires": [
            [
                "2dda5f57bc1ab5c8"
            ]
        ]
    },
    {
        "id": "2dda5f57bc1ab5c8",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2560,
        "y": 1160,
        "wires": []
    },
    {
        "id": "d88076e4d7713c05",
        "type": "change",
        "z": "384abcadb0af9821",
        "d": true,
        "name": "diun测试用",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "Diun",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.hostname & '上的容器有新版本发布' & '\\n' &\t$reverse($split(payload.image, \"/\"))[1] & '/' & $reverse($split(payload.image, \"/\"))[0]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'## ' & '**' & '发布平台：' & payload.provider & '**' & '\\n' &\t'## ' & '映像全称：' & payload.image & '\\n' &\t'### ' & '**' & '更新时间：' & $fromMillis($toMillis(payload.created), '[Y0001]/[M01]/[D01] [h#1]:[m01]') & '**' & '\\n' &\t'支持架构：' & payload.platform & '\\n' &\t'唯一标识：' & '`' & payload.digest & '\\n' &\t'抓取列表：' & payload.mime_type & '\\n' & '`'",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1470,
        "y": 1220,
        "wires": [
            [
                "e30c774c20dc50e4"
            ]
        ],
        "inputLabels": [
            "来自diun的消息"
        ],
        "info": "diun的测试通知里不含url，所以没办法加action，这个节点仅用于测试"
    },
    {
        "id": "467425758b8b35c7",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "重新包装消息",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "Wallos",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.subscriptioninfo.name & '订阅即将到期！！！'\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'💰订阅价格：' & payload.subscriptioninfo.payer & ' ➡️ ' & payload.subscriptioninfo.price & ' ' & payload.subscriptioninfo.currency & '\\n' &\t'📅订阅时限：' & payload.subscriptioninfo.days & '天' & '\\n' &\t'🔖订阅类别：' & payload.subscriptioninfo.catagory & '\\n' &\t'⏱️订阅日期：' & payload.subscriptioninfo.date & '\\n' &\t'🗒️订阅备注：' & payload.subscriptioninfo.notes & '\\n'\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "{\t    \"action\": \"view\",\t    \"label\": \"订阅官网\",\t    \"url\": payload.subscriptioninfo.url\t}",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "'http://192.168.5.8:8855/https://chevereto.181691.xyz:4584/images/2024/12/22/android-chrome-512x512.png'\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.tags",
                "pt": "msg",
                "to": "[\t    \"repeat\"\t]",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.days_until",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.subscriptionsinfo",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.subscriptioninfo",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1900,
        "y": 1340,
        "wires": [
            [
                "5c4ac1e118dc2496"
            ]
        ],
        "inputLabels": [
            "来自diun的消息"
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "5c4ac1e118dc2496",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "将打包好的JSON对象发送给nfty",
        "method": "POST",
        "ret": "bin",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "4"
            }
        ],
        "x": 2330,
        "y": 1340,
        "wires": [
            [
                "7c8f58964e5c2aad"
            ]
        ],
        "info": "将通知重新打包转发到ntfy的MoviePilot频道\r\n这里注意如果要用JSON的话转发URL里不能带订阅主题"
    },
    {
        "id": "7c8f58964e5c2aad",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"订阅即将到期\",\"type\":\"成功处理\",\"sender\":\"Wallos\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 1340,
        "wires": [
            [
                "af19d9d68e8af95e"
            ]
        ]
    },
    {
        "id": "af19d9d68e8af95e",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2760,
        "y": 1340,
        "wires": []
    },
    {
        "id": "de24cbccc28be417",
        "type": "function",
        "z": "384abcadb0af9821",
        "name": "循环处理同时快到期的每个订阅通知",
        "func": "for (let i = 0; i < msg.payload.subscriptionsinfo; i++) {\n    msg.payload.subscriptioninfo = msg.payload.subscriptionsinfo[i];\n    node.send(msg);   \n    node.done();\n}\nreturn;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 1340,
        "wires": [
            [
                "467425758b8b35c7"
            ]
        ]
    },
    {
        "id": "09d8170af4e4712e",
        "type": "file",
        "z": "384abcadb0af9821",
        "name": "记录传入数据",
        "filename": "/files/reNotify_log.txt",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 700,
        "y": 920,
        "wires": [
            [
                "311393612e864ede"
            ]
        ]
    },
    {
        "id": "3e8b67037dc3a327",
        "type": "change",
        "z": "384abcadb0af9821",
        "d": true,
        "name": "重新包装开始下载通知",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "MoviePilot",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.data.context.media_info.title_year & ( payload.data.context.media_info.season = null ? \" \" : (' ' & payload.data.context.media_info.season & ' ' & payload.data.context.meta_info.begin_episode & '—' & payload.data.context.meta_info.end_episode ) ) & '已开始下载'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "payload.data.text",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": \"https://mp.181691.xyz:4584/#/downloading\"\t    }\t\t    {\t        \"action\": \"view\",\t        \"label\": \"查看下载进度\",\t        \"url\": \"https://qb.181691.xyz:4584\"\t    }\t]\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "http://192.168.5.8:8855/images/2024/12/25/R-C.png",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.attach",
                "pt": "msg",
                "to": "payload.data.image",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload.type",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.data",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1920,
        "y": 640,
        "wires": [
            [
                "5f29bbf5670694b2"
            ]
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "5f29bbf5670694b2",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "将打包好的JSON对象发送给nfty",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "3"
            }
        ],
        "x": 2330,
        "y": 700,
        "wires": [
            [
                "2760b9551e56cf2d"
            ]
        ],
        "info": "将通知重新打包转发到ntfy的MoviePilot频道\r\n这里注意如果要用JSON的话转发URL里不能带订阅主题"
    },
    {
        "id": "2760b9551e56cf2d",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"资源下载通知发送成功\",\"type\":\"成功处理\",\"sender\":\"MP Webhook\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 700,
        "wires": [
            [
                "11cb82e1a68ea22e"
            ]
        ]
    },
    {
        "id": "11cb82e1a68ea22e",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2760,
        "y": 700,
        "wires": []
    },
    {
        "id": "936875b3ff892833",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "将打包好的JSON对象发送给nfty",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "3"
            }
        ],
        "x": 2330,
        "y": 820,
        "wires": [
            [
                "342c8cbcab1e41c8"
            ]
        ],
        "info": "将通知重新打包转发到ntfy的MoviePilot频道\r\n这里注意如果要用JSON的话转发URL里不能带订阅主题"
    },
    {
        "id": "342c8cbcab1e41c8",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"订阅完成通知发送成功\",\"type\":\"成功处理\",\"sender\":\"MP Webhook\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 820,
        "wires": [
            [
                "bcf7b7af382633c4"
            ]
        ]
    },
    {
        "id": "bcf7b7af382633c4",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2760,
        "y": 820,
        "wires": []
    },
    {
        "id": "1c6d068f286bd40d",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "给消息打上时间戳标记",
        "rules": [
            {
                "t": "set",
                "p": "payload.time",
                "pt": "msg",
                "to": "iso",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 920,
        "wires": [
            [
                "09d8170af4e4712e",
                "eabc066bdd78c542"
            ]
        ]
    },
    {
        "id": "3c7af06b72fec21e",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "重新包装开始下载通知",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "MoviePilot",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.data.context.media_info.title_year & (payload.data.context.meta_info.season_episode != '' ? ' ' & payload.data.context.meta_info.season_episode : '' ) & ' 已开始下载'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'【来自用户】' & payload.data.username & '\\n' & \t'【质量】' & payload.data.context.meta_info.resource_pix & ' ' & payload.data.context.meta_info.resource_type & '\\n' &\t'【编码格式】' & payload.data.context.meta_info.video_encode & ' ' & payload.data.context.meta_info.audio_encode & '\\n' &\t'【下载器】' & payload.data.downloader & '\\n' &\t'【大小】' & ((payload.data.context.torrent_info.size / 10000000000000 >= 1) ? ($round(payload.data.context.torrent_info.size / 1000000000000, 2) & ' TB') : (payload.data.context.torrent_info.size / 1000000000 >= 1 ? ($round(payload.data.context.torrent_info.size / 1000000000, 2) & ' GB') : ($round(payload.data.context.torrent_info.size / 1000000, 2) & ' MB'))) & '\\n' &\t'【站点】' & payload.data.context.torrent_info.site_name & '\\n' &\t'【做种数】' & payload.data.context.torrent_info.seeders & '\\n' &\t'【种子发布日期】' & payload.data.context.torrent_info.pubdate & '\\n' &\t'【种子】' & payload.data.context.torrent_info.title & '\\n' & \t'【描述】' & payload.data.context.torrent_info.description & '\\n' &\t(payload.data.context.media_info.last_air_date = null ? '' : ('【上次有新集释出】' & payload.data.context.media_info.last_air_date) ) & \t(payload.data.context.torrent_info.labels != [] ? ('\\n' & '【标签】' & $join(payload.data.context.torrent_info.labels, '·')) : '' )",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "payload.data.context.media_info.homepage = '' ? \t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": (payload.data.context.media_info.type = \"电影\" ? \"https://mp.181691.xyz:4584/#/subscribe/movie\" : \"https://mp.181691.xyz:4584/#/subscribe/tv\")\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.context.media_info.detail_link\t    }\t]\t:\t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": (payload.data.context.media_info.type = \"电影\" ? \"https://mp.181691.xyz:4584/#/subscribe/movie\" : \"https://mp.181691.xyz:4584/#/subscribe/tv\")\t    },\t\t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.context.media_info.detail_link\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"官网\",\t        \"url\": payload.data.context.media_info.homepage\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "payload.data.context.media_info.logo_path = null ? \"https://chevereto.181691.xyz:4584/images/2024/12/26/1000087726.png\" : payload.data.context.media_info.logo_path",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.attach",
                "pt": "msg",
                "to": "payload.data.context.media_info.backdrop_path",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.type",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.data",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.time",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1920,
        "y": 700,
        "wires": [
            [
                "5f29bbf5670694b2"
            ]
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "62098ff47103bd51",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "重新包装订阅已完成通知",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "MoviePilot",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.data.mediainfo.title_year & (payload.data.mediainfo.season_episode != '' ? ' ' & payload.data.mediainfo.season_episode : '' ) & ' 已完成订阅'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'【来自用户】' & payload.data.subscribe_info.username & '\\n' & \t'【评分】' & payload.data.mediainfo.vote_average & '\\n' &\t'【流行度】' & $round(payload.data.mediainfo.popularity, 2) & '%' & '\\n' &\t'【类别】' & payload.data.mediainfo.category & '\\n' &\t'【时长】' & (payload.data.mediainfo.episode_run_time != [] ? ((($sum(payload.data.mediainfo.episode_run_time) / 60) ~>$floor()) & ' 小时 ' & ($sum(payload.data.mediainfo.episode_run_time) % 60 & ' 分钟')) : ((payload.data.mediainfo.runtime / 60 ~> $floor()) & ' 小时 ' & payload.data.mediainfo.runtime % 60 & ' 分钟') )\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "payload.data.mediainfo.homepage = '' ? \t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": (payload.data.mediainfo.type = \"电影\" ? \"https://mp.181691.xyz:4584/#/subscribe/movie\" : \"https://mp.181691.xyz:4584/#/subscribe/tv\")\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.mediainfo.detail_link\t    }\t]\t:\t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在MP中查看\",\t        \"url\": (payload.data.mediainfo.type = \"电影\" ? \"https://mp.181691.xyz:4584/#/subscribe/movie\" : \"https://mp.181691.xyz:4584/#/subscribe/tv\")\t    },\t\t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.mediainfo.detail_link\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"官网\",\t        \"url\": payload.data.mediainfo.homepage\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "payload.data.mediainfo.logo_path != null ? payload.data.mediainfo.logo_path : \"https://chevereto.181691.xyz:4584/images/2024/12/26/1000087726.png\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.attach",
                "pt": "msg",
                "to": "payload.data.mediainfo.poster_path",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.data",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.type",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.time",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1930,
        "y": 820,
        "wires": [
            [
                "936875b3ff892833"
            ]
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "55c8ef842e4a4cd2",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "重新包装资源已入库通知",
        "rules": [
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "MoviePilot",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.title",
                "pt": "msg",
                "to": "payload.data.mediainfo.title_year & (payload.data.meta.season_episode != '' ? ' ' & payload.data.meta.season_episode : '' ) & ' 已入库'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "'【评分】' & payload.data.mediainfo.vote_average & '\\n' &\t'【热度指数】 ' & $round(payload.data.mediainfo.popularity, 2) & '\\n' &\t'【类别】' & payload.data.mediainfo.category & '\\n' &\t'【质量】' & payload.data.meta.resource_pix & ' ' & payload.data.meta.resource_type & '\\n' & \t'【编码格式】' & payload.data.meta.video_encode & ' ' & payload.data.meta.audio_encode & '\\n' &\t'【时长】' & (payload.data.mediainfo.episode_run_time != [] ? ((($sum(payload.data.mediainfo.episode_run_time) / 60) ~>$floor()) & ' 小时 ' & ($sum(payload.data.mediainfo.episode_run_time) % 60 & ' 分钟')) : (payload.data.mediainfo.runtime = null ? '未知' :((payload.data.mediainfo.runtime / 60 ~> $floor()) & ' 小时 ' & payload.data.mediainfo.runtime % 60 & ' 分钟') )) & '\\n' &\t(\t    payload.data.transferinfo.success ? (\t        '【转移路径】[ ' & '\\\"' & $substringBefore(payload.data.transferinfo.fileitem.path, payload.data.transferinfo.fileitem.name) & '\\\"' & ' ➡️ ' & '\\\"' & payload.data.transferinfo.target_diritem.path & '\\\"' & ']' & ' 共 ' & payload.data.transferinfo.file_count & ' 个文件，大小：' & ((payload.data.transferinfo.total_size / 10000000000000 >= 1) ? ($round(payload.data.transferinfo.total_size / 1000000000000, 2) & ' TB') : (payload.data.transferinfo.total_size / 1000000000 >= 1 ? ($round(payload.data.transferinfo.total_size / 1000000000, 2) & ' GB') : ($round(payload.data.transferinfo.total_size / 1000000, 2) & ' MB')))\t    ) \t    :(\t        \"【转移失败】\"\t    )\t)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.actions",
                "pt": "msg",
                "to": "payload.data.mediainfo.homepage = '' ? \t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在Plex中查看\",\t        \"url\": (payload.data.mediainfo.type = \"电影\" ? \"https://plex.181691.xyz:4584/web/index.html#!/media/60cd39c82986c502c8fbdfa5ddd027ca3a5cf922/com.plexapp.plugins.library?source=2\" : \"https://plex.181691.xyz:4584/web/index.html#!/media/60cd39c82986c502c8fbdfa5ddd027ca3a5cf922/com.plexapp.plugins.library?source=1\")\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.mediainfo.detail_link\t    }\t]\t:\t[\t    {\t        \"action\": \"view\",\t        \"label\": \"在Plex中查看\",\t        \"url\": (payload.data.mediainfo.type = \"电影\" ? \"https://plex.181691.xyz:4584/web/index.html#!/media/60cd39c82986c502c8fbdfa5ddd027ca3a5cf922/com.plexapp.plugins.library?source=2\" : \"https://plex.181691.xyz:4584/web/index.html#!/media/60cd39c82986c502c8fbdfa5ddd027ca3a5cf922/com.plexapp.plugins.library?source=1\")\t    },\t    {\t        \"action\": \"view\",\t        \"label\": \"TMDB\",\t        \"url\": payload.data.mediainfo.detail_link\t    },\t    \t    {\t        \"action\": \"view\",\t        \"label\": \"官网\",\t        \"url\": payload.data.mediainfo.homepage\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.icon",
                "pt": "msg",
                "to": "payload.data.mediainfo.logo_path != null ? payload.data.mediainfo.logo_path : \"https://chevereto.181691.xyz:4584/images/2024/12/26/1000087726.png\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.attach",
                "pt": "msg",
                "to": "payload.data.mediainfo.poster_path",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.data",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.type",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.time",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1930,
        "y": 940,
        "wires": [
            [
                "52ad28652218e09c"
            ]
        ],
        "info": "这里测试时不能加payload.\r\n但是实际使用时需要加，因为实际传入的msg才是根目录，而不是msg.payload\r\n长的逻辑表达式之间也需要用&连接\r\n\r\naction中用到了判断，判定该影视是否存在官网，如果有的话加上相应的按钮"
    },
    {
        "id": "52ad28652218e09c",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "将打包好的JSON对象发送给nfty",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "3"
            }
        ],
        "x": 2330,
        "y": 940,
        "wires": [
            [
                "49ca3f683af1edd7"
            ]
        ],
        "info": "将通知重新打包转发到ntfy的MoviePilot频道\r\n这里注意如果要用JSON的话转发URL里不能带订阅主题"
    },
    {
        "id": "49ca3f683af1edd7",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"转移成功通知发送成功\",\"type\":\"成功处理\",\"sender\":\"MP Webhook\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 940,
        "wires": [
            [
                "2b23b974d8707efb"
            ]
        ]
    },
    {
        "id": "2b23b974d8707efb",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2760,
        "y": 940,
        "wires": []
    },
    {
        "id": "376d93f341066c0b",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"Movie Pilot 通知转发失败\",\"type\":\"无匹配的MP事件类型\",\"sender\":\"MP Webhook\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1890,
        "y": 1060,
        "wires": [
            [
                "66eb0c795259065a"
            ]
        ]
    },
    {
        "id": "85374902ec5bcb77",
        "type": "function",
        "z": "384abcadb0af9821",
        "d": true,
        "name": "初始化一系列函数（勿删）",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// 部署节点后，此处添加的代码将运行一次。 \n// 定义格式化时间戳函数，取自ChatGPT\nglobal.set(\"formatTimestamp\", function (timestamp) {\n    const date = new Date(timestamp);\n\n    // 获取各部分时间\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份从 0 开始，需要加 1\n    const day = String(date.getDate()).padStart(2, '0');\n    const hour = String(date.getHours()).padStart(2, '0'); // 24 小时制\n    const minute = String(date.getMinutes()).padStart(2, '0');\n    const second = String(date.getSeconds()).padStart(2, '0');\n\n    // 格式化为 \"某年某月某日某时某分某秒\" 的形式\n    return `${year} 年 ${month} 月 ${day} 日 ${hour} 时 ${minute} 分 ${second} 秒`;\n});\n// console.log(formatTimestampWithPadding(timestamp));\n// 输出：2025年01月19日06时53分54秒\n\nconst formatTimestamp = global.get(\"formatTimestamp\");\n\n// 顺序处理异步队列消息函数，延迟1秒\nglobal.set(\"processItemSequentially\", function processItem(index, entries, packaged_msg) {\n    return new Promise((resolve, reject) => {\n        console.log(`处理第 ${index} 个条目`);\n\n        // 模拟异步操作（例如 setTimeout）\n        setTimeout(function() {\n            try {\n                // 处理数组的当前项\n                packaged_msg.payload.message = (\n                    \"标题：\" + entries[index].title + \"\\n\" +\n                    \"发布时间：\" + formatTimestamp(entries[index].pulished_at) + \"\\n\" +\n                    \"阅读时间：\" + entries[index].reading_time + \" 分钟\"\n                );\n                packaged_msg.payload.actions = [     \n                    {     \n                        \"action\": \"view\",     \n                        \"label\": \"查看详情\",     \n                        \"url\": entries[index].url    \n                    } \n                ];\n\n                // 打印当前消息内容\n                console.log(`发送消息：`, packaged_msg.payload);\n\n                // 按顺序发送消息\n                node.send(packaged_msg); \n\n                // 如果还没有处理完所有项，继续处理下一个\n                if (index < entries.length - 1) {\n                    processItem(index + 1, entries, packaged_msg)\n                        .then(resolve)\n                        .catch(reject);\n                } else {\n                    console.log(\"所有数组元素已处理完\");\n                    resolve(\"已处理完所有数组元素\");\n                }\n            } catch (error) {\n                console.error(\"发生错误:\", error);\n                reject(error);\n            }\n        }, 1000);  // 延迟1秒模拟异步操作\n    });\n});\n",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "311393612e864ede",
        "type": "delay",
        "z": "384abcadb0af9821",
        "name": "避免消息拥堵",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 940,
        "y": 920,
        "wires": [
            [
                "58673e9845f4a0ef"
            ]
        ]
    },
    {
        "id": "f8d0bd8d5c2f6a65",
        "type": "inject",
        "z": "384abcadb0af9821",
        "name": "测试用，直接注入payload即可",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"type\":\"transfer.complete\",\"data\":{\"fileitem\":{\"storage\":\"local\",\"type\":\"file\",\"path\":\"/media/Media Source/TV Series Source/地：关于地球的运动/Orb.On.the.Movements.of.the.Earth.S01.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb/Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb.mkv\",\"name\":\"Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb.mkv\",\"basename\":null,\"extension\":\"mkv\",\"size\":961483640,\"modify_time\":null,\"children\":[],\"fileid\":null,\"parent_fileid\":null,\"thumbnail\":null,\"pickcode\":null,\"drive_id\":null,\"url\":null},\"meta\":{\"org_string\":\"Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb\",\"subtitle\":null,\"isfile\":true,\"_source\":\"WEB-DL\",\"_effect\":[],\"tokens\":{\"_text\":\"Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb\",\"_tokens\":[\"Orb\",\"On\",\"the\",\"Movements\",\"of\",\"the\",\"Earth\",\"S01E20\",\"1080p\",\"NF\",\"WEB\",\"DL\",\"AAC2\",\"0\",\"H\",\"264\",\"MWeb\"],\"_index\":17},\"en_name\":\"Orb On The Movements Of The Earth\",\"_last_token_type\":\"videoencode\",\"_continue_flag\":true,\"_stop_name_flag\":true,\"type\":\"电视剧\",\"begin_season\":1,\"total_season\":1,\"begin_episode\":20,\"total_episode\":1,\"resource_pix\":\"1080p\",\"_last_token\":\"H\",\"audio_encode\":\"AAC 2.0\",\"video_encode\":\"H264\",\"resource_type\":\"WEB-DL\",\"cn_name\":null,\"resource_team\":null,\"customization\":null,\"title\":\"Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb.mkv\",\"apply_words\":[],\"year\":null,\"resource_effect\":null,\"part\":null,\"end_season\":null,\"season_episode\":\"S01 E20\",\"edition\":\"WEB-DL\",\"name\":\"Orb On The Movements Of The Earth\",\"episode_list\":[20]},\"mediainfo\":{\"source\":\"themoviedb\",\"type\":\"电视剧\",\"title\":\"地。—关于地球的运动—\",\"en_title\":\"Orb: On the Movements of the Earth\",\"hk_title\":\"地。-關於地球的運動-\",\"tw_title\":\"地。-關於地球的運動-\",\"sg_title\":\"チ。―地球の運動について―\",\"year\":\"2024\",\"season\":1,\"tmdb_id\":204635,\"imdb_id\":\"tt33044444\",\"tvdb_id\":421583,\"douban_id\":null,\"bangumi_id\":null,\"collection_id\":null,\"original_language\":\"ja\",\"original_title\":\"チ。―地球の運動について―\",\"release_date\":\"2024-10-05\",\"backdrop_path\":\"https://image.tmdb.org/t/p/original/o5GDX8zmKLpOxRkBoAonoQL8gbg.jpg\",\"poster_path\":\"https://image.tmdb.org/t/p/original/1VkZ8OeEkN3xUhftVjNisX9CJ2J.jpg\",\"logo_path\":\"https://assets.fanart.tv/fanart/tv/421583/hdtvlogo/chi-regarding-the-movement-of-the-earth-66b71f884225d.png\",\"vote_average\":7.7,\"overview\":\"15世纪欧洲的某个国家，有一位跳级被大学录取的神通拉法尔。因为周围的期待，他宣布要进修当时被认为最为重要的学问“神学”。但是，对于一直都热心投入的天文学，他也难以舍弃。某一天，他遇到了一个叫休伯特的神秘学者。据说休伯特因为接触到了基于异端思想的禁忌研究，被关进过监狱。而他研究的，是和宇宙有关的，冲击力十足的“某个假说”——\",\"genre_ids\":[16,18],\"names\":[\"关于地球的运动\",\"地。—关于地球的运动—\",\"Chi: Chikyū no Undō ni Tsuite\",\"Chi: Chikyuu no Undou ni Tsuite\",\"Chi Chikyuu No Undo Ni Tsuite\",\"Chi - Chikyuu no Undou ni Tsuite\",\"Chi. Chikyuu no Undou ni Tsuite\",\"O ruchach Ziemi\",\"محاكم التفتيش ودوران الأرض\",\"Chi: Regarding the Movement of the Earth\",\"Chi: About the Movement of the Earth\",\"Chi: On the Movements of the Earth\",\"Orb: On the Movements of the Earth\",\"Du mouvement de la Terre\",\"Tierra, sangre, conocimiento: Sobre el movimiento de la Tierra\",\"地。-關於地球的運動-\",\"Orbe: Sobre os Movimentos da Terra\",\"지. -지구의 운동에 대하여-\",\"Ketzer – Tödliches Wissen über die Bewegung der Erde\",\"Il movimento della Terra\",\"สุริยะปราชญ์ ทฤษฎีสีเลือด\",\"Chi Chikyuu no Undou\",\"Chi: Về Sự Chuyển Động Của Địa Cầu\",\"О движении Земли\",\"Орбіта: Про рух Землі\"],\"seasons\":{\"1\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]},\"season_info\":[{\"air_date\":\"2024-10-05\",\"episode_count\":25,\"id\":298335,\"name\":\"第 1 季\",\"overview\":\"\",\"poster_path\":\"/eVbdeWTZPcRiulJJkofwex9AhdS.jpg\",\"season_number\":1,\"vote_average\":9.6}],\"season_years\":{\"1\":\"2024\"},\"category\":\"日番\",\"tmdb_info\":null,\"douban_info\":null,\"bangumi_info\":null,\"directors\":[{\"adult\":false,\"gender\":1,\"id\":1352117,\"known_for_department\":\"Editing\",\"name\":\"木村佳史子\",\"original_name\":\"木村佳史子\",\"popularity\":1.64,\"profile_path\":null,\"credit_id\":\"67027e07e4801491468597df\",\"department\":\"Editing\",\"job\":\"Editor\"}],\"actors\":[],\"adult\":false,\"created_by\":[],\"episode_run_time\":[25],\"genres\":[{\"id\":16,\"name\":\"动画\"},{\"id\":18,\"name\":\"剧情\"}],\"first_air_date\":\"2024-10-05\",\"homepage\":\"https://anime-chi.jp/\",\"languages\":[\"ja\"],\"last_air_date\":\"2025-02-01\",\"networks\":[{\"id\":469,\"logo_path\":\"/3E5bxm9VfOU9LkAX545jtpKAe6Z.png\",\"name\":\"NHK G\",\"origin_country\":\"JP\"}],\"number_of_episodes\":25,\"number_of_seasons\":1,\"origin_country\":[\"JP\"],\"original_name\":\"チ。―地球の運動について―\",\"production_companies\":[{\"id\":3464,\"logo_path\":\"/9k0nr75nwnNeT2MHerf1OXJN0hj.png\",\"name\":\"Madhouse\",\"origin_country\":\"JP\"},{\"id\":249260,\"logo_path\":null,\"name\":\"SKY Perfect Pictures\",\"origin_country\":\"JP\"},{\"id\":9149,\"logo_path\":\"/isLUpud9N56ifftJZ4XvzwBBpoG.png\",\"name\":\"Shogakukan\",\"origin_country\":\"JP\"},{\"id\":11376,\"logo_path\":\"/lrglrxyGOMRl9KCsmcjmzjjpT2H.png\",\"name\":\"NHK Enterprises\",\"origin_country\":\"JP\"},{\"id\":12655,\"logo_path\":\"/dfGqf2NoMVPrDywDL90D5HAhBlW.png\",\"name\":\"Shogakukan-Shueisha Productions\",\"origin_country\":\"JP\"}],\"production_countries\":[{\"iso_3166_1\":\"JP\",\"name\":\"Japan\"}],\"spoken_languages\":[{\"english_name\":\"Japanese\",\"iso_639_1\":\"ja\",\"name\":\"日本語\"}],\"status\":\"Returning Series\",\"tagline\":\"\",\"vote_count\":14,\"popularity\":104.128,\"runtime\":null,\"next_episode_to_air\":{\"id\":5649562,\"name\":\"第 20 集\",\"overview\":\"\",\"vote_average\":0,\"vote_count\":0,\"air_date\":\"2025-02-08\",\"episode_number\":20,\"episode_type\":\"standard\",\"production_code\":\"\",\"runtime\":25,\"season_number\":1,\"show_id\":204635,\"still_path\":\"/fakScG50nsJi4guNEhIQVPAzDeF.jpg\"},\"content_rating\":\"TV-MA\",\"clearart_path\":\"https://assets.fanart.tv/fanart/tv/421583/hdclearart/chi-regarding-the-movement-of-the-earth-66b71fa750cf1.png\",\"background_path\":\"https://assets.fanart.tv/fanart/tv/421583/showbackground/chi-regarding-the-movement-of-the-earth-66b71fb162c0c.jpg\",\"thumb_path\":\"https://assets.fanart.tv/fanart/tv/421583/tvthumb/orb-on-the-movements-of-the-earth-6731bd6a30c2e.jpg\",\"detail_link\":\"https://www.themoviedb.org/tv/204635\",\"title_year\":\"地。—关于地球的运动— (2024)\"},\"transferinfo\":{\"success\":true,\"fileitem\":{\"storage\":\"local\",\"type\":\"file\",\"path\":\"/media/Media Source/TV Series Source/地：关于地球的运动/Orb.On.the.Movements.of.the.Earth.S01.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb/Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb.mkv\",\"name\":\"Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb.mkv\",\"basename\":null,\"extension\":\"mkv\",\"size\":961483640,\"modify_time\":null,\"children\":[],\"fileid\":null,\"parent_fileid\":null,\"thumbnail\":null,\"pickcode\":null,\"drive_id\":null,\"url\":null},\"target_diritem\":{\"storage\":\"local\",\"type\":\"dir\",\"path\":\"/media/TV Series/地。—关于地球的运动— (2024)/\",\"name\":\"地。—关于地球的运动— (2024)\",\"basename\":\"地。—关于地球的运动— (2024)\",\"extension\":null,\"size\":null,\"modify_time\":1732527342.339104,\"children\":[],\"fileid\":null,\"parent_fileid\":null,\"thumbnail\":null,\"pickcode\":null,\"drive_id\":null,\"url\":null},\"target_item\":{\"storage\":\"local\",\"type\":\"file\",\"path\":\"/media/TV Series/地。—关于地球的运动— (2024)/Season 1 (2024)/地。—关于地球的运动— - S01E20 - 第 20 集.mkv\",\"name\":\"地。—关于地球的运动— - S01E20 - 第 20 集.mkv\",\"basename\":\"地。—关于地球的运动— - S01E20 - 第 20 集\",\"extension\":\"mkv\",\"size\":961483640,\"modify_time\":1739078021.074555,\"children\":[],\"fileid\":null,\"parent_fileid\":null,\"thumbnail\":null,\"pickcode\":null,\"drive_id\":null,\"url\":null},\"transfer_type\":\"link\",\"file_count\":1,\"file_list\":[\"/media/Media Source/TV Series Source/地：关于地球的运动/Orb.On.the.Movements.of.the.Earth.S01.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb/Orb.On.the.Movements.of.the.Earth.S01E20.1080p.NF.WEB-DL.AAC2.0.H.264-MWeb.mkv\"],\"file_list_new\":[\"/media/TV Series/地。—关于地球的运动— (2024)/Season 1 (2024)/地。—关于地球的运动— - S01E20 - 第 20 集.mkv\"],\"total_size\":961483640,\"fail_list\":[],\"message\":null,\"need_scrape\":true,\"need_notify\":true},\"downloader\":\"qBittorrent\",\"download_hash\":\"01104a48d9cbad86c8444cd285fe82bec45f5d6a\"},\"time\":\"2025-02-09T05:17:39.171Z\"}",
        "payloadType": "json",
        "x": 900,
        "y": 840,
        "wires": [
            [
                "58673e9845f4a0ef"
            ]
        ]
    },
    {
        "id": "523620a1dba7aa6e",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"无匹配的RSS主题\",\"type\":\"转发失败\",\"sender\":\"RSSPush\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1890,
        "y": 380,
        "wires": [
            [
                "7859c34cc7a7adbb"
            ]
        ]
    },
    {
        "id": "7859c34cc7a7adbb",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "400",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2080,
        "y": 380,
        "wires": []
    },
    {
        "id": "ce083f6e8e7f05f9",
        "type": "switch",
        "z": "384abcadb0af9821",
        "name": "判断是何种RSS主题",
        "property": "payload.feed.title",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "($contains(msg.payload.feed.title, \"临时工\") and $contains(msg.payload.feed.title, \"其乐\"))\t",
                "vt": "jsonata"
            },
            {
                "t": "cont",
                "v": "PT风向旗",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "直播间开播",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "Spotify",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 1500,
        "y": 220,
        "wires": [
            [
                "361c00df29de8d66"
            ],
            [
                "d928a7167cf5da03"
            ],
            [
                "c9357eda6797b1dc"
            ],
            [
                "944c8132d8c514db"
            ],
            [
                "523620a1dba7aa6e"
            ]
        ]
    },
    {
        "id": "effef2d97094c50e",
        "type": "function",
        "z": "384abcadb0af9821",
        "name": "循环处理每条新RSS消息",
        "func": "// 定义重新包装后的JSON\nconst packaged_msg = {\n    \"payload\": {\n        // 定义是否处理完RSS队列中所有RSS的标志 \n        \"task_done\": false,\n        \"topic\": \"RSS\",\n        \"title\": \"该RSS消息无标题\"\n    }\n};\n\nswitch(msg.payload.type){\n    case 1: \n        packaged_msg.payload.title = \"🎉 其乐Keylol上有新的临时工消息 ！！！\";\n        packaged_msg.payload.icon = \"https://keylol.com/template/steamcn_metro/src/img/common/icon_with_text_256h.png\";\n        break;\n    case 2: \n        packaged_msg.payload.title = \"⛓️ PT站点有新的动态 ！！！\";\n        packaged_msg.payload.icon = \"https://chevereto.181691.xyz:4584/images/2024/12/25/R-C.png\";\n        break;\n    case 3: \n        packaged_msg.payload.title = \"📺 \" + msg.payload.feed.title.split(\"直播间\")[0] + \"开播了 ！！！\";\n        packaged_msg.payload.icon = \"https://chevereto.181691.xyz:4584/images/2025/01/20/6f8f7c8cc03f5a68028fddb3f8c74ac1.png\";\n        break;\n    case 4: \n        packaged_msg.payload.title = \"🎶 \";\n        packaged_msg.payload.icon = \"\";\n        break;\n\n    default: break;\n};\n\n// 调用初始化函数中定义的格式化时间戳函数\nconst formatTimestamp = global.get(\"formatTimestamp\");\n\n// // 循环遍历RSS队列中的每条RSS\n// for (const entry of msg.payload.entries) {\n//     // 重新包装消息\n//     packaged_msg.payload.message = (\n//         \"标题：\" + entry.title + \"\\n\" +\n//         // 使用获取的函数格式化时间戳\n//         \"发布时间：\" + formatTimestamp(entry.pulished_at) + \"\\n\" +\n//         \"阅读时间：\" + entry.reading_time + \" 分钟\"\n//     );\n//     packaged_msg.payload.actions = [\n//         {\n//             \"action\": \"view\",\n//             \"label\": \"查看详情\",\n//             \"url\": entry.url\n//         }\n//     ]\n\n//     node.send(packaged_msg);\n//     node.done();\n// };\n\n// 顺序处理异步队列消息函数，延迟1秒\nfunction processItem(index, entries, packaged_msg) {\n    return new Promise((resolve, reject) => {\n        // 模拟异步操作（例如 setTimeout）\n        setTimeout(function() {\n            try {\n                // 处理数组的当前项\n                packaged_msg.payload.message = (\n                    // 设置标题并去掉标题中的时间戳\n                    \"标题：\" + global.get(\"removeTimestamp\")(entries[index].title) + \"\\n\" +\n                    // 使用获取的函数格式化时间戳\n                    \"发布时间：\" + formatTimestamp(entries[index].published_at) + \"\\n\" +\n                    \"阅读时间：\" + entries[index].reading_time + \" 分钟\"\n                );\n                packaged_msg.payload.actions = [     \n                    {     \n                        \"action\": \"view\",     \n                        \"label\": \"查看详情\",     \n                        \"url\": entries[index].url    \n                    } \n                ];\n\n                // 根据Spotify不同艺人执行不同的操作\n                if (entries[index].title.includes(\"Anson Seabra\")) {\n                    // 执行操作1\n                    packaged_msg.payload.title = \"🎶 Anson Seabra 刚刚发布了新专辑 ！！！\";\n                    packaged_msg.payload.icon = \"https://chevereto.181691.xyz:4584/images/2025/01/20/1c2f75aef88029fda496b38f0b1e6bbe.jpg\";\n                    // 在这里添加操作1的代码\n                } else if (entries[index].title.includes(\"Hayd\")) {\n                    // 执行操作2\n                    packaged_msg.payload.title = \"🎶 Hayd 刚刚发布了新专辑 ！！！\";\n                    packaged_msg.payload.icon = \"https://chevereto.181691.xyz:4584/images/2025/01/20/73d4f0fc0a3a396a89341d35b258dc80.jpg\";\n                    // 在这里添加操作2的代码\n                }\n\n                // 按顺序发送消息\n                node.send(packaged_msg); \n\n                // 如果还没有处理完所有项，继续处理下一个\n                if (index < entries.length - 1) {\n                    // 递归调用，返回 Promise 保证顺序\n                    processItem(index + 1, entries, packaged_msg)\n                        .then(resolve)\n                        .catch(reject);\n                } else {\n                    // 已处理完所有元素，返回完成的消息\n                    resolve(\"已处理完所有数组元素\");\n                }\n            } catch (error) {\n                reject(error);\n            }\n        }, 500);  // 延迟0.5秒模拟异步操作\n    });\n};\n\nconst beginIndex = 0;\nprocessItem(beginIndex, msg.payload.entries, packaged_msg);\n\n// RSS队列中所有消息处理完后，更改处理标记为已完成\nmsg.payload.task_done = true\nreturn msg;",
        "outputs": 1,
        "timeout": "0",
        "noerr": 0,
        "initialize": "// 部署节点后，此处添加的代码将运行一次。 \n// 定义格式化时间戳函数，取自ChatGPT\n// 初始化函数中定义格式化函数并存储到 global 上下文中\nglobal.set(\"formatTimestamp\", function (timestamp) {\n    const date = new Date(timestamp);\n\n    // 获取各部分时间\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份从 0 开始，需要加 1\n    const day = String(date.getDate()).padStart(2, '0');\n    const hour = String(date.getHours()).padStart(2, '0'); // 24 小时制\n    const minute = String(date.getMinutes()).padStart(2, '0');\n    const second = String(date.getSeconds()).padStart(2, '0');\n\n    // 格式化为 \"某年某月某日某时某分某秒\" 的形式\n    return `${year} 年 ${month} 月 ${day} 日 ${hour} 时 ${minute} 分 ${second} 秒 `;\n});\n// console.log(formatTimestampWithPadding(timestamp));\n// 输出：2025年01月19日06时53分54秒\n\n\n// 格式化BiliBili直播RSS消息的标题\nglobal.set(\"removeTimestamp\", function (inputString) {\n    // 使用正则表达式匹配日期时间格式 YYYY-MM-DD HH:MM:SS\n    const regex = /\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$/;\n\n    // 使用正则表达式替换掉时间部分\n    const resultString = inputString.replace(regex, '').trim();  // `trim()` 用于去掉末尾的多余空格\n\n    return resultString;\n});\n",
        "finalize": "",
        "libs": [],
        "x": 2310,
        "y": 120,
        "wires": [
            [
                "8e116e36148db9a6",
                "d8f0df193f320810"
            ]
        ]
    },
    {
        "id": "8e116e36148db9a6",
        "type": "switch",
        "z": "384abcadb0af9821",
        "name": "",
        "property": "payload.task_done",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2550,
        "y": 100,
        "wires": [
            [
                "8bcc0c584e4cffa4"
            ],
            [
                "7ba4373f9834a9e2"
            ]
        ],
        "outputLabels": [
            "循环处理RSS队列消息",
            "处理完成，发送响应"
        ]
    },
    {
        "id": "361c00df29de8d66",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "设定RSS消息类型",
        "rules": [
            {
                "t": "set",
                "p": "payload.type",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1910,
        "y": 60,
        "wires": [
            [
                "effef2d97094c50e"
            ]
        ]
    },
    {
        "id": "d928a7167cf5da03",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "设定RSS消息类型",
        "rules": [
            {
                "t": "set",
                "p": "payload.type",
                "pt": "msg",
                "to": "2",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1910,
        "y": 100,
        "wires": [
            [
                "effef2d97094c50e"
            ]
        ]
    },
    {
        "id": "c9357eda6797b1dc",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "设定RSS消息类型",
        "rules": [
            {
                "t": "set",
                "p": "payload.type",
                "pt": "msg",
                "to": "3",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1910,
        "y": 140,
        "wires": [
            [
                "effef2d97094c50e"
            ]
        ]
    },
    {
        "id": "7ba4373f9834a9e2",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "编辑响应体",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"title\":\"RSS消息\",\"type\":\"成功处理\",\"sender\":\"RSSPush\",\"destination\":\"Self-Hosted Ntfy\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 160,
        "wires": [
            [
                "7b591d3f3eb78188"
            ]
        ]
    },
    {
        "id": "7b591d3f3eb78188",
        "type": "http response",
        "z": "384abcadb0af9821",
        "name": "转发完成",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 2940,
        "y": 160,
        "wires": []
    },
    {
        "id": "8bcc0c584e4cffa4",
        "type": "http request",
        "z": "384abcadb0af9821",
        "name": "RSS消息转发到nfty",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.5.8:9050/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer tk_tl1po03abi41c7fe4zk3m0lagfd6s"
            },
            {
                "keyType": "other",
                "keyValue": "Priority",
                "valueType": "other",
                "valueValue": "3"
            }
        ],
        "x": 2770,
        "y": 80,
        "wires": [
            []
        ],
        "inputLabels": [
            "来源为RSSPush"
        ],
        "info": "消息比较简单，用Webhook方式重新转发到ntfy"
    },
    {
        "id": "d8f0df193f320810",
        "type": "debug",
        "z": "384abcadb0af9821",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2560,
        "y": 200,
        "wires": []
    },
    {
        "id": "944c8132d8c514db",
        "type": "change",
        "z": "384abcadb0af9821",
        "name": "设定RSS消息类型",
        "rules": [
            {
                "t": "set",
                "p": "payload.type",
                "pt": "msg",
                "to": "4",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1910,
        "y": 180,
        "wires": [
            [
                "effef2d97094c50e"
            ]
        ]
    }
]
